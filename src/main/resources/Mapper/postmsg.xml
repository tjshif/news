<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.school.DAO.IPostmsgDao" >
    <sql id ="Full_Column">
        ID,
        content,
        imagePaths,
        newsType,
        newsSubType,
        postDate,
        locationCode,
        isHot,
        isValid,
        updateAt,
        updateBy,
        publisherId
    </sql>

    <insert id="insert" parameterType="com.school.Entity.PostmsgDTO">
        insert into Postmsg (<include refid="Full_Column"/>) values
        (#{ID},
        #{content},
        #{imagePaths},
        #{newsType},
        #{newsSubType},
        #{postDate},
        #{locationCode},
        #{isHot},
        #{isValid},
        now(),
        #{updateBy},
        #{publisherId});
    </insert>

    <select id="selectPostmsgByPage" resultType="com.school.Entity.PostmsgDTO" >
        SELECT NN.ID ID, content, newsType, newsSubType, imagePaths, postDate, locationCode,
        isHot, NN.postDate CreateAt, publisherId, NickName publishSource
        FROM Postmsg NN
        inner join User UR on NN.publisherId = UR.ID
        WHERE NewsType = #{newsType}
        <if test="newsSubType != null">
            and newsSubType = #{newsSubType}
        </if>
        <if test="locationCode != null and locationCode != 0">
            and locationCode = #{locationCode}
        </if>
        AND isValid = '1'
        order by NN.ID desc Limit #{offset}, #{pageSize}
    </select>



</mapper>